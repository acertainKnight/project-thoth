# ==============================================================================
# Thoth AI Research Assistant - Docker Compose Override
# Local development overrides and customizations
# This file is automatically loaded by docker-compose and can be customized
# ==============================================================================

version: '3.8'

services:
  # ==============================================================================
  # Thoth App Overrides
  # Local development customizations
  # ==============================================================================
  thoth-app:
    # Use development Dockerfile with UV best practices
    build:
      context: .
      dockerfile: Dockerfile.dev
      target: runtime  # Multi-stage build: builder -> runtime

    # Override for local development
    environment:
      # Local development settings
      - THOTH_LOG_LEVEL=DEBUG
      - THOTH_DEV_MODE=1

    volumes:
      # Mount source code for hot-reload development (no rebuild needed!)
      # Editable install means Python picks up changes immediately!
      - ./src:/app/src
      - ./pyproject.toml:/app/pyproject.toml:ro

      # Mount local configuration if it exists
      - ./config.local.yml:/app/config.local.yml:ro

      # Mount local workspace directory (commented out to use main docker-compose.yml mount)
      # - ./workspace:/workspace

    # Override port mappings for development (maintain remapping to avoid conflicts)
    ports:
      - "8080:8000"  # API server (remapped to avoid local dev conflicts)
      - "8081:8001"  # MCP server (remapped to avoid local dev conflicts)
      - "5678:5678"  # Debug port

