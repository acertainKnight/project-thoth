[supervisord]
nodaemon=true
logfile=/vault/_thoth/logs/supervisord.log
logfile_maxbytes=10MB
logfile_backups=3
loglevel=info
pidfile=/tmp/supervisord.pid
user=thoth

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
chown=thoth:thoth

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# =============================================================================
# Thoth API Server
# =============================================================================
[program:thoth-api]
command=python -m thoth server start --api-host 0.0.0.0 --api-port 8000 --no-discovery --no-mcp
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/vault/_thoth/logs/api-stdout.log
stderr_logfile=/vault/_thoth/logs/api-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
priority=100
user=thoth
environment=PATH="/app/.venv/bin:%(ENV_PATH)s",PYTHONPATH="/app/src"

# =============================================================================
# Thoth MCP Server
# =============================================================================
[program:thoth-mcp]
command=python -m thoth mcp http --host 0.0.0.0 --port 8001
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/vault/_thoth/logs/mcp-stdout.log
stderr_logfile=/vault/_thoth/logs/mcp-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
priority=200
user=thoth
environment=PATH="/app/.venv/bin:%(ENV_PATH)s",PYTHONPATH="/app/src"

# =============================================================================
# Thoth Discovery Scheduler
# =============================================================================
[program:thoth-discovery]
command=python -m thoth discovery scheduler start
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/vault/_thoth/logs/discovery-stdout.log
stderr_logfile=/vault/_thoth/logs/discovery-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
priority=300
user=thoth
environment=PATH="/app/.venv/bin:%(ENV_PATH)s",PYTHONPATH="/app/src"

# =============================================================================
# Thoth PDF Monitor
# =============================================================================
[program:thoth-pdf-monitor]
command=python -m thoth system monitor --optimized --recursive
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/vault/_thoth/logs/monitor-stdout.log
stderr_logfile=/vault/_thoth/logs/monitor-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
priority=400
user=thoth
environment=PATH="/app/.venv/bin:%(ENV_PATH)s",PYTHONPATH="/app/src"

# =============================================================================
# Process Groups
# =============================================================================
[group:thoth-services]
programs=thoth-api,thoth-mcp,thoth-discovery,thoth-pdf-monitor
priority=999
